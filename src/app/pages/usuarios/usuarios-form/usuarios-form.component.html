<form [formGroup]="formularioUsuario" (ngSubmit)="guardar()">
  <!-- Datos del usuario -->
  <mat-card class="mb-4">
    <mat-card-title>Datos del usuario</mat-card-title>
    <mat-card-content>
      <div class="row g-3">
        <mat-form-field class="col-md-4">
          <mat-label>Nombre(s)</mat-label>
          <input matInput formControlName="nombre" placeholder="Nombre" />
          <mat-error *ngIf="hasError('nombre', 'required')">El nombre es requerido</mat-error>
          <mat-error *ngIf="hasError('nombre', 'minlength')">Mínimo 2 caracteres</mat-error>
        </mat-form-field>

        <mat-form-field class="col-md-4">
          <mat-label>Apellido Paterno</mat-label>
          <input matInput formControlName="apellidoPaterno" placeholder="Apellido Paterno" />
          <mat-error *ngIf="hasError('apellidoPaterno', 'required')">El apellido paterno es requerido.</mat-error>
          <mat-error *ngIf="hasError('apellidoPaterno', 'minlength')">Debe tener al menos 2 caracteres.</mat-error>
        </mat-form-field>

        <mat-form-field class="col-md-4">
          <mat-label>Apellido Materno</mat-label>
          <input matInput formControlName="apellidoMaterno" placeholder="Apellido Materno" />
          <mat-error *ngIf="hasError('apellidoMaterno', 'required')">El apellido materno es requerido.</mat-error>
          <mat-error *ngIf="hasError('apellidoMaterno', 'minlength')">Debe tener al menos 2 caracteres.</mat-error>
        </mat-form-field>

        <mat-form-field class="col-md-6">
          <mat-label>Email</mat-label>
          <input matInput type="email" formControlName="email" placeholder="usuario@correo.com" />
          <mat-error *ngIf="hasError('email', 'required')">El email es requerido</mat-error>
          <mat-error *ngIf="hasError('email', 'email')">Correo inválido</mat-error>
        </mat-form-field>

        <mat-form-field class="col-md-6">
          <mat-label>Teléfono</mat-label>
          <input matInput type="tel" formControlName="telefono" maxlength="10" placeholder="10 dígitos" pattern="[0-9]{10}" (input)="onInputNumber($event)"/>
          <mat-error *ngIf="hasError('telefono', 'required')"> El teléfono es requerido </mat-error>
          <mat-error *ngIf="hasError('telefono', 'pattern')"> Debe contener exactamente 10 números </mat-error>
          </mat-form-field>

        <mat-form-field class="col-md-6">
          <mat-label>Fecha de registro</mat-label>
          <input matInput formControlName="fechaRegistro" [readonly]="true" />
        </mat-form-field>

        <mat-form-field class="col-md-6">
          <mat-label>Último acceso</mat-label>
          <input matInput formControlName="ultimoAcceso" [readonly]="true" />
        </mat-form-field>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card class="mb-4">
    <mat-card-title>Credenciales</mat-card-title>
    <mat-card-content>
      <div class="row g-3">
        <mat-form-field class="col-md-4">
          <mat-label>Usuario</mat-label>
          <input matInput formControlName="username" placeholder="Usuario" />
          <mat-error *ngIf="hasError('username', 'required')">El usuario es requerido</mat-error>
          <mat-error *ngIf="hasError('username', 'minlength')">Mínimo 4 caracteres</mat-error>
        </mat-form-field>

        <mat-form-field class="col-md-4">
          <mat-label>Contraseña</mat-label>
          <input matInput [type]="hide ? 'password' : 'text'" formControlName="password" placeholder="Contraseña" />
          <button mat-icon-button matSuffix type="button" (click)="hide = !hide">
            <mat-icon>{{ hide ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          <mat-error *ngIf="hasError('password', 'required')">La contraseña es obligatoria</mat-error>
          <mat-error *ngIf="hasError('password', 'minlength')">Mínimo 6 caracteres</mat-error>
        </mat-form-field>

        <mat-form-field class="col-md-4">
          <mat-label>Confirmar contraseña</mat-label>
          <input matInput [type]="hideConfirm ? 'password' : 'text'" formControlName="confirmPassword" placeholder="Repite la contraseña" />
          <button mat-icon-button matSuffix type="button" (click)="hideConfirm = !hideConfirm">
            <mat-icon>{{ hideConfirm ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          <mat-error *ngIf="formularioUsuario.hasError('passwordMismatch') && formularioUsuario.get('confirmPassword')?.touched">
            Las contraseñas no coinciden
          </mat-error>
        </mat-form-field>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card class="mb-4">
    <mat-card-title>Permisos y estado</mat-card-title>
    <mat-card-content>
      <div class="row g-3">
        <mat-form-field class="col-md-6">
          <mat-label>Estado</mat-label>
          <mat-select formControlName="estado">
            <mat-option value="activo">Activo</mat-option>
            <mat-option value="inactivo">Inactivo</mat-option>
            <mat-option value="bloqueado">Bloqueado</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field class="col-md-6">
          <mat-label>Rol</mat-label>
          <mat-select formControlName="rol">
            <mat-option value="admin">Administrador</mat-option>
            <mat-option value="doctor">Doctor</mat-option>
            <mat-option value="recepcionista">Recepcionista</mat-option>
            <mat-option value="enfermeria">Enfermería</mat-option>
            <mat-option value="contabilidad">Contabilidad</mat-option>
            <mat-option value="otro">Otro</mat-option>
          </mat-select>
          <mat-error *ngIf="hasError('rol', 'required')">El rol es requerido</mat-error>
        </mat-form-field>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Extras -->
  <mat-card class="mb-4">
    <mat-card-title>Extras</mat-card-title>
    <mat-card-content>
      <div class="row g-3">
        <mat-form-field class="col-md-4">
          <mat-label>Menú asignado</mat-label>
          <input matInput formControlName="menu" placeholder="Menú" />
        </mat-form-field>

        <mat-form-field class="col-md-4">
          <mat-label>Departamento</mat-label>
          <input matInput formControlName="departamento" placeholder="Departamento" />
        </mat-form-field>

        <mat-form-field class="col-md-4">
          <mat-label>Avatar (URL)</mat-label>
          <input matInput formControlName="avatar" placeholder="URL de avatar" />
        </mat-form-field>
      </div>

      <div *ngIf="formularioUsuario.get('avatar')?.value" style="margin-top:1rem; text-align:center;">
        <img [src]="formularioUsuario.get('avatar')?.value" alt="Avatar" width="100" height="100" style="border-radius:50%;">
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Acciones -->
  <div style="display: flex; justify-content: flex-end; gap: 1rem">
    <button mat-stroked-button type="button" (click)="cancelar()">
      <mat-icon>close</mat-icon> Cancelar
    </button>
    <button mat-raised-button color="primary" type="submit" [disabled]="formularioUsuario.invalid">
      <mat-icon>save</mat-icon> Guardar
    </button>
  </div>
</form>
